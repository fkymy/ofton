<h2>ダッシュボード <span><%= link_to "保存", admin_metrics_path, :method => :post %></span></h2>
<!-- <% link_to "保存", admin_metrics_path(@user, params: { user: { age: 19} }), :method => :put %> -->

<h4 style="margin-top: 30px;"><%= @week_ago %> ~<br> <%= @today %></h4>
<br>
<hr>
<h5 style="margin-top: 30px; color: red;"><p>ユーザー数</p></h4>
<div class="table-responsive">
  <table class="table table-striped table-responsive">
    <thead>
      <tr>
        <th>ALL</th>
        <th>MAU</th>
        <th>WAU</th>
        <th>BiAU</th>
        <th>DAU</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @all_users %>
        <td><%= @monthly_active_users %>
        <td><%= @weekly_active_users %>
        <td><%= @bi_active_users %>
        <td><%= @daily_active_users %>
      </tr>
    </tbody>
  </table>
</div>
<br>
<hr>
<h5 style="margin-top: 30px; color: red;"><p>ユーザーリテンション</p></h4>
[wip] 30日前のデータがたまるまでまつ．GAを見てくれ． (エンゲージメントは mixpanelよさそう)<br>
Ce - Cn / Cs, for e is end, s is start, n is new
WAUe - Un / WAUsがよいのかな．．？
<br>
<br>
<hr>
<h5 style="margin-top: 30px; color: red;"><p>ユーザーファネル</p></h4>
<div class="table-responsive">
  <table class="table table-striped table-responsive">
    <thead>
      <tr>
        <th>新規ユーザーの...</th>
        <th>登録数 / 訪問数(GA)</th>
        <th>アクション数 / 登録数</th>
        <th>マジモメ数 / アクション数</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">週間</th>
        <td><%= @new_users %> / GAの新規訪問数</td>
        <td><%= @new_users == 0 ? 'NA' : ((@all_posts / @new_users.to_f) * 100).round(2) %>%</td>
        <td><%= @all_posts == 0 ? 'NA' : ((@mm / @all_posts.to_f) * 100).round(2) %>%</td>
      </tr>
    </tbody>
  </table>
</div>

<br>
<hr>
<h5 style="margin-top: 30px; color: red;"><p>集計した数値</p></h4>
<div class="table-responsive">
  <table class="table table-striped table-responsive">
    <thead>
      <tr>
        <th></th>
        <th>新規訪問数</th>
        <th>新規ユーザー登録数</th>
        <th>新規ユーザーアクション数</th>
        <th>新規ユーザーアクション内訳 (投稿 : コメント)</th>
        <th>新規ユーザーマジモメ数</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">週間</th>
        <td>NA</td>
        <td><%= @new_users %></td>
        <td><%= @all_posts %></td>
        <td><%= @posts_ratio.round(2) %> : <%= @comments_ratio.round(2) %></td>
        <td><%= @mm %></td>
      </tr>
    </tbody>
  </table>
</div>

<br>
<hr>
<h5 style="margin-top: 30px; color: red;"><p>ユーザーファネル 別バージョン</p></h4>
<div class="table-responsive">
  <table class="table table-striped table-responsive">
    <thead>
      <tr>
        <th>新規の...</th>
        <th>ユーザー登録数 / 訪問数(GA)</th>
        <th>アクション数 / ユーザー登録数</th>
        <th>ユニークマジモメ数 / ユニークアクション数</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">週間</th>
        <td><%= @new_users %> / GAの新規訪問数</td>
        <td><%= @new_users == 0 ? 'NA' : ((@all_posts / @new_users.to_f) * 100).round(2) %>%</td>
        <td><%= @uniq_posts == 0 ? 'NA' : ((@uniq_mm / @uniq_posts.to_f) * 100).round(2) %>%</td>
      </tr>
    </tbody>
  </table>
</div>
<span>新規ユーザーユニークアクション数: <%= @uniq_posts %> | 新規ユーザーユニークマジモメ数: <%= @uniq_mm %></span>
<br>
<hr>
